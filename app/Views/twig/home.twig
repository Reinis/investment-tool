{% extends "base.twig" %}

{% block title %}Investment Tool{% endblock %}

{% block search %}
    <div class="flex p-4 mb-4 justify-center">
        {% set method = method ?? 'quote' %}
        <form action="/quote" method="post" class="flex items-baseline rounded overflow-hidden">
            <select name="method" class="flex p-2 pr-7 border-0 border-r bg-gray-300 hover:bg-gray-400">
                <option value="quote"{% if method == 'quote' %} selected{% endif %}>Quote</option>
            </select>
            <input type="search" name="symbol" placeholder="Symbol" class="flex p-2 bg-gray-200 border-0"
                   {% if symbol %}value="{{ symbol }}"{% endif %}>
            <input type="submit" name="quote" value="Get" class="flex p-2 bg-gray-700 text-gray-300">
        </form>
    </div>
    {% if quote %}
        <div class="grid gid-cols-2 gap-4 justify-items-center">
            <div class="grid grid-cols-2 gap-2 fields">
                <span>O</span><span>{{ quote.O }}</span>
                <span>H</span><span>{{ quote.H }}</span>
                <span>L</span><span>{{ quote.L }}</span>
                <span>C</span><span>{{ quote.C }}</span>
                <span>Pc</span><span>{{ quote.Pc }}</span>
            </div>
            <div class="grid grid-cols-1 gap-2 mb-4">
                <form action="/buy" method="post" class="inputs">
                    <label for="amount">Amount</label>
                    <input type="number" id="amount" placeholder="0" name="amount">
                    <input type="hidden" name="symbol" value="{{ symbol }}">
                    <input type="hidden" name="quote" value="{{ quote.C }}">
                    <input type="submit" class="btn-gray font-bold" value="Buy">
                </form>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block transactions %}
    <div class="flex justify-center">
        <table class="w-4/5 border-collapse">
            <tr>
                <th>Id</th>
                <th>Symbol</th>
                <th>Quote</th>
                <th>Quote Date</th>
                <th>Amount</th>
                <th>Total</th>
                <th>Closed</th>
                <th>Closing Value</th>
                <th>Closing Date</th>
                <th>Action</th>
            </tr>
            {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.id }}</td>
                    <td>{{ transaction.symbol }}</td>
                    <td>{{ transaction.quote / 1000 }}</td>
                    <td>{{ transaction.quoteDate | date("Y-m-d H:i:s") }}</td>
                    <td>{{ transaction.amount }}</td>
                    <td>{{ transaction.quote / 1000 * transaction.amount }}</td>
                    <td>{% if transaction.closed %}true{% else %}false{% endif %}</td>
                    <td>{% if transaction.closed %}{{ transaction.closingValue / 1000 }}{% endif %}</td>
                    <td>{% if transaction.closed %}{{ transaction.closingDate | date("Y-m-d H:i:s") }}{% endif %}</td>
                    <td>
                        <div class="flex justify-around items-center">
                            {% if transaction.closed %}
                                <form action="/delete/{{ transaction.id }}" method="post">
                                    <input type="submit" value="Delete"
                                           class="hover:bg-gray-500 w-24 text-red-600 border border-red-600 px-4 py-1 mx-1 rounded cursor-pointer">
                                </form>
                                <div class="w-32">
                                </div>
                            {% else %}
                                <div class="w-32">
                                </div>
                                <a href="/close/{{ transaction.id }}">
                                    <button
                                        class="hover:bg-gray-600 text-green-400 border border-green-400 w-24 px-4 py-1 mx-1 rounded">
                                        Close
                                    </button>
                                </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}
